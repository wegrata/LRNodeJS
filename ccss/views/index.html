 <div class="container">	
 	<div class="modal" id="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div style="height: 30px;" class="modal-header timelineModal">

			<a class="btn" data-placement="left" rel="tooltip" data-original-title="Bookmark Resource" data-bind="visible: !isCurrentBookmarked(), click: moveResourceToBookmark" style="float: right;" href="#">
				<i class="icon-heart"></i>
			</a>
			<a class="btn disabled" data-placement="left" rel="tooltip" data-original-title="Remove from Bookmarks" data-bind="visible: isCurrentBookmarked(), click: moveResourceToBookmark" style="float: right; cursor: pointer;" href="#">
				<i class="icon-heart"></i>
			</a>
			<a data-placement="right" rel="tooltip" data-original-title="Back" class="btn backButtonModal"  style="float: left; cursor: pointer;" href="#">
				<i class="icon-arrow-left"></i>
			</a>
			<div>
				<span data-bind="text: currentObject().title"></span>
			</div>
		</div>

		<div class="modal-timeline">
			<table id="timeline-table" class="table table-striped">
				<tbody data-bind="foreach: currentObject().timeline">
				
				
					<tr><td data-bind="style: { 'background-color': $index()%2 == 1 ? '#F9F9F9' : '#FFF', 'border-top': $index()==0 ? 'none' : '1px #DDD solid'}">
									   
							<div data-bind="html: $root.generateParadataText($data, $index()), attr:{id: 'paradata' + $index() }"></div>
									   

						</td>
									   
									   
					</tr>
				</tbody>
			</table>

			<span data-bind="if: checkTimelineLength(currentObject().timeline) == 0">&nbsp;&nbsp;Be the first to interact!</span>
		</div>
		
		<div class="modal-iframe">
			<div id="mBody" class="modal-body">
				<div id="spinnerDiv" style="margin: 100px auto; height: 20%; width:20%;"></div>
			</div>
		</div>


		<div class="chatTools">
			<span style="border-right: 1px solid #aaa">
				<a data-bind="click: handleDataClick" href="#" data-placement="top" rel="tooltip" data-original-title="View Metadata"><i class="icon-file"></i></a>
			</span>
			<span style="border-right: 1px solid #aaa">
				<a href="#" data-placement="top" rel="tooltip" data-original-title="Vote Up"><i class="icon-plus"></i></a>&nbsp;
				<a href="#" data-placement="top" rel="tooltip" data-original-title="Vote Down"><i class="icon-minus"></i></a>
			</span>
			<span>
				<a href="#" data-placement="top" rel="tooltip" data-original-title="Flag for Review"><i class="icon-flag"></i></a>
			</span>
		</div>
		<div class="chatBox">
			<textarea placeholder="Add comment here (press Enter to send)."></textarea>
		</div>
	</div>

      <!-- Example row of columns -->
      <div class="row">
		<div class="span3">
			<div class="row">
				<div class="accordion friends" id="accordion2" data-bind="foreach: followers">

				  <div class="accordion-group">

					<div class="accordion-heading">
					  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" data-bind="attr:{href:$root.getCollapseId(name, '#')}, text: name" ></a>
					  <!-- ko if: $data.isUser -->
						<i style="float: right; margin: 9px;" class="icon-user"></i>
					  <!-- /ko -->
					</div>

					<div data-bind="attr:{id:$root.getCollapseId(name)}" class="accordion-body collapse">
					  <div class="accordion-inner" style="height:200px;">
						Info:<br/>
						Total Resources:<br/>
						New Resources:<br/>

						<!-- ko foreach: content -->
							<div class="draggable lr_border_trans pull-left" data-bind="attr: {name: $root.generateName($parentContext.$index(), $index(), 'followers')}">
								<span style="white-space: nowrap;" data-bind="text: title"></span><br/>

							</div>
						<!-- /ko -->

					  </div>
					</div>

				  </div>
				</div>
			</div>
			<div class="row dropbox">
				<span data-bind="visible: bookmarks().length == 0" class="dropText">Drop stuff</span>

				<!-- ko foreach: bookmarks -->
					<div class="draggable lr_border_trans pull-left">
						<span style="white-space: nowrap;" data-bind="text: $data, attr:{name:$data}"></span><br/>

					</div>
				<!-- /ko -->

			</div>
		</div>
		<div class="span8 offset1">
		  	<div class="row">

				<div style="text-align: center;" data-bind="foreach: data" >
					<div data-bind="if: $index() < numOfPreviewElements" class="span3">

						<div class="customH4">
							<span data-bind="text: name"></span>
							<a data-bind="click: $root.followOrganization" class="btn btn-small"><i class="icon-plus-sign"></i></a>
						</div>

						<!-- ko foreach: content -->
							<div class="draggable lr_border_trans pull-left" data-bind="attr: {name: $root.generateName($parentContext.$index(), $index(), 'data')}">

								<span style="white-space: nowrap;" data-bind="text: $data.title"></span><br/>
								<img src="/images/qmark.png" />
							</div>
						<!-- /ko -->
					</div>
				</div>



				<div id="index-tabs">
					<ul class="nav nav-tabs">
						<li><a class="dynLoad" id="defaultTab" href="#organizations">Sites</a></li>
						<li><a class="dynLoad" href="#browser">Standards Brower</a></li>
						<li><a class="dynLoad" href="#users">Users</a></li>
					</ul>

					<div class="tab-content">
					  <div class="tab-pane active" id="browser"></div>
					  <div class="tab-pane" id="users">
						<p>Others with your occupation</p>
						<dl>
							{{#sameOccupation}}
								<dt>{{.}}</dt>
							{{/sameOccupation}}
						</dl>
					  </div>
					  <div class="tab-pane accordion friends" id="organizations"  data-bind="foreach:allOrganizations">
							<div class="accordion-group organizationAcc">

								<div class="accordion-heading">
								  <a class="accordion-toggle" data-parent="#organizations" data-toggle="collapse"  data-bind="html: $data, attr:{href:$root.getOrganizationAccordionId($index, '#')}" ></a>
								</div>

								<div data-bind="attr:{id:$root.getOrganizationAccordionId($index, '')}" class="accordion-body collapse">
								  <div class="accordion-inner" style="height:100px;">

									<div class="customH4">

										<p>Possibly a preview of a few resources...</p><br/>
										<a data-bind="click: $root.followOrganization" class="btn btn-small"><i class="icon-star"></i> Follow Organization</a>
										<a data-bind="attr:{name:$index()}" class="btn btn-small followOrg"><i class="icon-th-large"></i> View All Resources</a>

									</div>
								  </div>
								</div>
						   </div>
					  </div>

					</div>
				</div>


			</div>
		</div>
      </div>
 </div>

 	<div class="modal" id="visualBrowser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div style="height: 30px;" class="modal-header visualModal">
			<a data-placement="right" rel="tooltip" data-original-title="Back" class="btn backButtonModal"  style="float: left; cursor: pointer;" href="#">
				<i class="icon-arrow-left"></i>
			</a>
			<div>
				<span id="doc_list_header"></span> <span>Search</span>
			</div>
		</div>

		<div class="resultModal">




			<table class="table table-striped">
				<tbody data-bind="foreach: visualBrowserResults">
					<tr>
						<td style="padding-top: 15px; padding-bottom: 15px;">
							<a class="resultClick" style="color: #666;" data-bind="text:$root.getShorterArr(keys, 4), attr:{name: $root.getShorterArr(url)}"><br/></a>
							<a class="resultClick" data-bind="text:$root.getShorterArr(url, 50), attr:{name: $root.getShorterArr(url)}"></a>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		<div class="infovizModal">

			<div id="infovis"></div>

			<div class="text" >
				<div style="text-align: center;">
					<div id="progressbar" align="center"></div>
				</div>
				<div id="status">
					...
				</div>
			</div>
			<br>
			<div class="text">
				<div id="results_summary"></div>
			</div>
			<br>
			<div id = "debugDiv" class="text">
				<div id="debug">
					...
				</div>
			</div>

		</div>
	</div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	<script src="https://login.persona.org/include.js"></script>
	<script src="/javascripts/moment.min.js"></script>
	<script src="/javascripts/prettify.js"></script>

	<script src="/javascripts/jquery.js"></script>
	<script src="//code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
	<script src="/javascripts/bootstrap.js"></script>

	<script type="text/javascript" src="/javascripts/libs/modernizr-2.0.6.min.js"></script>
	<script type="text/javascript" src="/javascript/ui/jquery.cookie.js"></script>
	<script type="text/javascript" src="/javascripts/libs/jquery.ba-hashchange.min.js.txt"></script>

	<script type="text/javascript" src="/javascript/jquery.xml2json.js"></script>
	<script type="text/javascript" src="/javascript/ui/jquery.eComboBox.js"></script>

	<script src="/javascripts/Placeholders.js"></script>
	<script src="/javascripts/spin.min.js"></script>
	<script src="/javascripts/jquery.nicescroll.js"></script>

	<script language="javascript" type="text/javascript" src="/javascript/jit-yc.js"></script>
	<script type="text/javascript" src="/javascript/lrbrowser.js"></script>
	<script type="text/javascript" src="/javascript/paradata.js"></script>
	<script type="text/javascript" src="/javascript/utils.js"></script>
	<link type="text/css" href="/themes/Aristo/Aristo.css" rel="stylesheet" />
	<!--<link type="text/css" href="themes/demos.css" rel="stylesheet" />-->
	<link type="text/css" href="/stylesheets/Hypertree.css" rel="stylesheet" />
	<link type="text/css" href="/stylesheets/prettify.css" rel="stylesheet" />

	<script type="text/javascript">

		  //if user is new:
		  $("[rel=tooltip]").tooltip();

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-26825770-1']);
		  _gaq.push(['_trackPageview']);

		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

		var allOrganizations = "{{orgs}}".split(",");
		var followed = "{{followed}}".split(",");
		var allTerms = "{{terms}}".split(",");

		//console.log({{orgs}});
	</script>
	<script src="/javascripts/application.js"></script>
	<script>
		var temp = new mainViewModel([]), activeModalName = null, lastSearchCache = "";

		//Last modal location should either be home, or visual
		var lastModalLocation = "home";
		for (var f in followed){
			temp.followers.push({name:followed[f], content:[]});
		}
		
		ko.applyBindings(temp);
		/*$.getJSON('/resources',function(data){

			console.log(data);
			return;
			for(var title in data){
				var items = new Array();
				for(var i in data[title]){
					items.push(new resourceObject(data[title][i].title, data[title][i].resource_url))
				}
				temp.data.push(new previewObject(title, data[title]));
			}

		})

		<% for(var i in relationships){ %>
			var title = "<%= relationships[i].title %>";
			var r = new previewObject(title,[]);
			temp.followers.push(r);
		<%}%>*/

		$("#modal").hide();
		var initialGraphBuild = false;
		$(document).ready(function(){
s			
			$('input, textarea').placeholder();

			//Handle what happens when the back button is clicked
			$(".backButtonModal").click(function(e){

				e.preventDefault();
				e.stopPropagation();
				
				lastModalLocation = (directAccess === true && lastModalLocation == "visual") ? "home" : lastModalLocation;
				$(".prettyprint").remove();
				
				if(lastModalLocation == "home"){

					$("#modalFrame").remove();
					$(".prettyprint").remove();
					$("#modal").modal("hide");
					//$("#modal").css("visibility", "hidden");

					$("#visualBrowser").modal("hide");
				}
				
				else if(lastModalLocation == "frame"){

					$(".prettyprint").remove();
					$("#mBody").append(saveFrameState);
					console.log(saveFrameState);
					generateContentFrame(lastContentFrameSource, true);
					lastModalLocation = "visual";
				}

				else{

					$("#modalFrame").remove();
					$(".prettyprint").remove();
					$("#modal").modal("hide");
					//$("#modal").css("visibility", "hidden");

					$("#visualBrowser").modal("show");
					lastModalLocation = "home";
				}

				
			});

			var handleDoSearch = function(e, str) {

				e.preventDefault();
				e.stopPropagation();
				lastModalLocation = "home";
				if(typeof str != "string"){
					//Enter was pressed
					if(e.which == 13){
						/* Additional optional logic. Is keyword or url search? */
						$("#visualBrowser").modal("show");

						//There's no reason to perform a new search if it's the same as the last
						str = $("#term").val();
						if(lastSearchCache != str){
							lastSearchCache = str;
							startNewSearch(str);
						}
					}
				}
				else {
					console.log(str);
					$("#visualBrowser").modal("show");

					//There's no reason to perform a new search if it's the same as the last
					if(lastSearchCache != str){
						lastSearchCache = str;
						startNewSearch(str);
					}
				}
			};


			$(".followOrg").click(function(e){

				//$("#term").val(allTerms[$(this).attr("name")]);
				handleDoSearch(e, allTerms[$(this).attr("name")]);

			});

			$("#term").keyup(handleDoSearch);
			$("#Search").click(handleDoSearch);

			enableDrag();
			enableModal();

			$(".chatBox textarea").keyup(function(e){

				//Enter was pressed
				if(e.which == 13){

					//add element to observable array, send a request via socketio, and remove current textarea value
					var mockParadata = {
						"activity": {
							"actor": {
								"objectType": "teacher",
								"description": [
								"You",
								"high school",
								"math"
								]
							},
							"verb": {
								"action": "commented",
								"detail": $(this).val(),
								"date": new Date()
							},
							"object": temp.currentObject().url
						}
					};

					console.log(temp.currentObject());
					temp.currentObject().timeline.push(mockParadata);

					scrollbarFix();

					//console.log($(".modal-timeline").getNiceScroll());
					$(this).val("");
				}
				//console.log(e.which);
			});

			$(".resultModal").on("click", ".resultClick", function(e){

				e.preventDefault();
				e.stopPropagation();

				$("#visualBrowser").modal("hide");
				handleMainResourceModal($(this).attr("name"));
				console.log("show click");
			});

			$("table").on("click", ".author-timeline", function(evt){

				$(".author-timeline").not(this).popover('hide');
				$(this).popover('toggle');

				//Enable tooltips
				$(".bottomBar i").tooltip();

				//evt.stopPropagation();
			});






					//LInitial tab display
			//$("#browser").load("/browser?ajax");
			$('#defaultTab').tab("show");
			var alreadyLoaded = ["#organizations"];


			/*$('.collapse').collapse('hide');
			$(".organizationAcc").click(function(){

				console.log("CLICK!");
				$(this).children(".collapse").collapse('toggle');
			});*/


			$(".dynLoad").click(function(e){
				e.preventDefault();

				var temp = $(this);
				temp.tab("show");

				//Check whether or not the tab has ever been clicked on
				if(jQuery.inArray(temp.attr("href"), alreadyLoaded) == -1){

					alreadyLoaded.push(temp.attr("href"));
					var saveName = temp.attr("href").split("#")[1];
					$("#" + saveName).load("/" + saveName + "?ajax");
				}
			});





		});

		var hidePopover = function(){

			$(".author-timeline").popover('hide');
		};

		var handleOnclickUserBar = function(obj){
			
			var cacheObj = $(obj);
			var name = cacheObj.attr("name");
			var className = cacheObj.attr("class");

			if(className == "icon-star")
				self.followUser(name);
				
			else if(className == "icon-file"){
				
				
			}
			
			//Substr gets the number portion of "paradataX"
			var test = cacheObj.attr("name").substr(8, cacheObj.attr("name").length-8);
			console.log(test, self.currentObject().timeline()[test]);
			displayObjectData(self.currentObject().timeline()[test]);
		};

	</script>

	<!--[if lt IE 7 ]>
		<script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.2/CFInstall.min.js"></script>
		<script>window.attachEvent("onload",function(){CFInstall.check({mode:"overlay"})})</script>
	<![endif]-->

<!--<script>
jQuery(function(){
        $("#Search").bind("click", function() {
                try {
                        var term = $("#term")[0].value;
                        _gaq.push(['_trackEvent', 'LRBrowser', 'Go', term.toLowerCase()]);
                } catch (e) {}
        });
});
</script>-->
