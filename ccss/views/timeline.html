<div class="timeline-container">
	<div class="modal-timeline">
		<table id="timeline-table" class="table table-striped">
			<tbody data-bind="foreach: currentObject().timeline">
			
			
				<tr><td data-bind="style: { 'background-color': $index()%2 == 1 ? '#F9F9F9' : '#FFF', 'border-top': $index()==0 ? 'none' : '1px #DDD solid'}">
								   
						<div data-bind="html: $root.generateParadataText($data, $index()), attr:{id: 'paradata' + $index() }"></div>
					</td>			   
				</tr>
			</tbody>
		</table>

		<span data-bind="if: checkTimelineLength(currentObject().timeline) == 0">&nbsp;&nbsp;Be the first to interact!</span>
	</div>
	
	<div class="modal-iframe">
		<div id="mBody" class="modal-body">
			<div id="spinnerDiv" style="margin: 100px auto; height: 20%; width:20%;"></div>
		</div>
	</div>


	<div class="chatTools">
		<span style="border-right: 1px solid #aaa">
			<a data-bind="click: handleDataClick" href="#" data-placement="top" rel="tooltip" data-original-title="View Metadata"><i class="icon-file"></i></a>
		</span>
		<span style="border-right: 1px solid #aaa">
			<a href="#" data-placement="top" rel="tooltip" data-original-title="Vote Up"><i class="icon-plus"></i></a>&nbsp;
			<a href="#" data-placement="top" rel="tooltip" data-original-title="Vote Down"><i class="icon-minus"></i></a>
		</span>
		<span>
			<a href="#" data-placement="top" rel="tooltip" data-original-title="Flag for Review"><i class="icon-flag"></i></a>
		</span>
	</div>
	<div class="chatBox">
		<textarea placeholder="Add comment here (press Enter to send)."></textarea>
	</div>
</div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	<script src="https://login.persona.org/include.js"></script>
	<script src="/javascripts/moment.min.js"></script>
	<script src="/javascripts/prettify.js"></script>

	<script src="/javascripts/jquery.js"></script>
	<script src="//code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
	<script src="/javascripts/bootstrap.js"></script>

	<script type="text/javascript" src="/javascripts/libs/modernizr-2.0.6.min.js"></script>
	<script type="text/javascript" src="/javascript/ui/jquery.cookie.js"></script>
	<script type="text/javascript" src="/javascripts/libs/jquery.ba-hashchange.min.js.txt"></script>

	<script type="text/javascript" src="/javascript/jquery.xml2json.js"></script>
	<script type="text/javascript" src="/javascript/ui/jquery.eComboBox.js"></script>

	<script src="/javascripts/Placeholders.js"></script>
	<script src="/javascripts/spin.min.js"></script>
	<script src="/javascripts/jquery.nicescroll.js"></script>

	<script language="javascript" type="text/javascript" src="/javascript/jit-yc.js"></script>
	<script type="text/javascript" src="/javascript/lrbrowser.js"></script>
	<script type="text/javascript" src="/javascript/paradata.js"></script>
	<script type="text/javascript" src="/javascript/utils.js"></script>
	<link type="text/css" href="/themes/Aristo/Aristo.css" rel="stylesheet" />
	<!--<link type="text/css" href="themes/demos.css" rel="stylesheet" />-->
	<link type="text/css" href="/stylesheets/Hypertree.css" rel="stylesheet" />
	<link type="text/css" href="/stylesheets/prettify.css" rel="stylesheet" />
	<script src="/javascripts/application.js"></script>
	<script>
	
	
		var allOrganizations = "{{orgs}}".split(","), allTerms = "{{terms}}".split(","), temp = new mainViewModel([]);
		handleMainResourceModal("{{query}}");
		console.log(allTerms);
		ko.applyBindings(temp);

		//Last modal location should either be home, or visual
		var lastModalLocation = "home";
		for (var f in followed){
			temp.followers.push({name:followed[f], content:[]});
		}

		/*$.getJSON('/resources',function(data){

			console.log(data);
			return;
			for(var title in data){
				var items = new Array();
				for(var i in data[title]){
					items.push(new resourceObject(data[title][i].title, data[title][i].resource_url))
				}
				temp.data.push(new previewObject(title, data[title]));
			}

		})

		<% for(var i in relationships){ %>
			var title = "<%= relationships[i].title %>";
			var r = new previewObject(title,[]);
			temp.followers.push(r);
		<%}%>*/

		$("#modal").hide();
		var initialGraphBuild = false;
		$(document).ready(function(){
			
			$('input, textarea').placeholder();

			//Handle what happens when the back button is clicked
			$(".backButtonModal").click(function(e){

				e.preventDefault();
				e.stopPropagation();
				
				lastModalLocation = (directAccess === true && lastModalLocation == "visual") ? "home" : lastModalLocation;
				$(".prettyprint").remove();
				
				if(lastModalLocation == "home"){
					$("#modalFrame").remove();
					$("#modal").modal("hide");

					$("#visualBrowser").modal("hide");
				}
				
				else if(lastModalLocation == "frame"){
					$("#mBody").append(saveFrameState);
					generateContentFrame(lastContentFrameSource, true);
					lastModalLocation = "visual";
				}

				else{
					$("#modalFrame").remove();
					$("#modal").modal("hide");

					$("#visualBrowser").modal("show");
					lastModalLocation = "home";
				}

				
			});

			var handleDoSearch = function(e, str) {

				e.preventDefault();
				e.stopPropagation();
				lastModalLocation = "home";
				if(typeof str != "string"){
					//Enter was pressed
					if(e.which == 13){
						/* Additional optional logic. Is keyword or url search? */
						$("#visualBrowser").modal("show");

						//There's no reason to perform a new search if it's the same as the last
						str = $("#term").val();
						if(lastSearchCache != str){
							lastSearchCache = str;
							startNewSearch(str);
						}
					}
				}
				else {
					console.log(str);
					$("#visualBrowser").modal("show");

					//There's no reason to perform a new search if it's the same as the last
					if(lastSearchCache != str){
						lastSearchCache = str;
						startNewSearch(str);
					}
				}
			};


			$(".followOrg").click(function(e){

				//$("#term").val(allTerms[$(this).attr("name")]);
				handleDoSearch(e, allTerms[$(this).attr("name")]);

			});

			$("#term").keyup(handleDoSearch);
			$("#Search").click(handleDoSearch);

			enableDrag();
			enableModal();

			$(".chatBox textarea").keyup(function(e){

				//Enter was pressed
				if(e.which == 13){

					//add element to observable array, send a request via socketio, and remove current textarea value
					var mockParadata = {
						"activity": {
							"actor": {
								"objectType": "teacher",
								"description": [
								"You",
								"high school",
								"math"
								]
							},
							"verb": {
								"action": "commented",
								"detail": $(this).val(),
								"date": new Date()
							},
							"object": temp.currentObject().url
						}
					};

					console.log(temp.currentObject());
					temp.currentObject().timeline.push(mockParadata);

					scrollbarFix();

					//console.log($(".modal-timeline").getNiceScroll());
					$(this).val("");
				}
				//console.log(e.which);
			});

			$(".resultModal").on("click", ".resultClick", function(e){

				e.preventDefault();
				e.stopPropagation();

				$("#visualBrowser").modal("hide");
				handleMainResourceModal($(this).attr("name"));
				console.log("show click");
			});

			$("table").on("click", ".author-timeline", function(evt){

				$(".author-timeline").not(this).popover('hide');
				$(this).popover('toggle');

				//Enable tooltips
				$(".bottomBar i").tooltip();

				//evt.stopPropagation();
			});






					//LInitial tab display
			//$("#browser").load("/browser?ajax");
			$('#defaultTab').tab("show");
			var alreadyLoaded = ["#organizations"];


			/*$('.collapse').collapse('hide');
			$(".organizationAcc").click(function(){

				console.log("CLICK!");
				$(this).children(".collapse").collapse('toggle');
			});*/


			$(".dynLoad").click(function(e){
				e.preventDefault();

				var temp = $(this);
				temp.tab("show");

				//Check whether or not the tab has ever been clicked on
				if(jQuery.inArray(temp.attr("href"), alreadyLoaded) == -1){

					alreadyLoaded.push(temp.attr("href"));
					var saveName = temp.attr("href").split("#")[1];
					$("#" + saveName).load("/" + saveName + "?ajax");
				}
			});





		});

		var hidePopover = function(){

			$(".author-timeline").popover('hide');
		};

		var handleOnclickUserBar = function(obj){
			
			var cacheObj = $(obj);
			var name = cacheObj.attr("name");
			var className = cacheObj.attr("class");

			if(className == "icon-star")
				self.followUser(name);
				
			else if(className == "icon-file"){
				
				
			}
			
			//Substr gets the number portion of "paradataX"
			var test = cacheObj.attr("name").substr(8, cacheObj.attr("name").length-8);
			console.log(test, self.currentObject().timeline()[test]);
			displayObjectData(self.currentObject().timeline()[test]);
		};
	</script>

	<!--[if lt IE 7 ]>
		<script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.2/CFInstall.min.js"></script>
		<script>window.attachEvent("onload",function(){CFInstall.check({mode:"overlay"})})</script>
	<![endif]-->

<!--<script>
jQuery(function(){
        $("#Search").bind("click", function() {
                try {
                        var term = $("#term")[0].value;
                        _gaq.push(['_trackEvent', 'LRBrowser', 'Go', term.toLowerCase()]);
                } catch (e) {}
        });
});
</script>-->


